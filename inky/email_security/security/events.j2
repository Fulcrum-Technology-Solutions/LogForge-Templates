{%- set user = registry.get_random_user() -%}
{%- set device = registry.get_random_device() -%}
{%- set timestamp = current_timestamp() -%}
{%- set sender_ip = random_ip() -%}

{
  "identifier": "inky-event",
  "data": {
    "inky_analysis": {
      "suspicious_details": {
        "reason_htmls": [],
        "reason_titles": [],
        "reason_ids": [],
        "reason_ids_ordered": [],
        "reason_short_codes": [],
        "short_reasons": [],
        "threat_level": {{ random_int(0, 10) }},
        "SCL": {{ random_int(0, 9) }},
        "PCL": {{ random_int(0, 9) }},
        "result_bucket": "{{ ['NEUTRAL', 'SUSPICIOUS', 'MALICIOUS'] | random }}"
      },
      "threat_indicators": []
    },
    "meta_data": {
      "dashboard_url": "https://protection.inkyphishfence.com/dashboard?teamid={{ context.organization }}&id={{ random_string(64) }}&sso={{ context.organization }}-okta-saml",
      "from_email": "{{ user.email }}",
      "internal": {{ [true, false] | random }},
      "internaldate_utc_seconds": {{ timestamp }},
      "rcpt_to_addresses": ["{{ registry.get_random_user().email }}"],
      "mail_from": "{{ user.username }}={{ user.email.split('@')[1] }}__{{ random_string(10) }}@{{ random_string(12) }}.{{ context.mail_domain }}",
      "sender_IP": "{{ sender_ip }}",
      "helo_string": "smtp-{{ random_string(16) }}.{{ random_string(10) }}.{{ context.mail_domain }}",
      "message_id": "<{{ random_string(30) }}@{{ context.mail_domain }}>",
      "subject": "{{ context.subject_prefix }} {{ ['Please review', 'Please approve', 'Action required', 'Important update'] | random }}",
      "authenticated_sources": ["{{ random_string(12) }}.{{ context.mail_domain }}", "{{ user.email.split('@')[1] }}"],
      "spf_passes": ["{{ random_string(12) }}.{{ context.mail_domain }}"],
      "dkim_passes": ["{{ user.email.split('@')[1] }}"],
      "dmarc_passes": ["{{ user.email.split('@')[1] }}"],
      "origin": "{{ ['Internal', 'External'] | random }}",
      "microsoft_SCL": {{ random_int(-1, 9) }},
      "silent_mode": {{ [true, false] | random }},
      "delivery_target": "{{ ['Inbox', 'Junk', 'Quarantine'] | random }}"
    }
  },
  "teamid": "{{ context.organization }}",
  "event_type": "analysis_result"
}