vendor: microsoft
product: o365
data_source: azure-active-directory
description: Records Azure Active Directory role assignment operations, particularly additions to privileged roles like Global Administrator, which represent privilege escalation and potential security risks
format: JSON
frequency: low
is_generator: true
base_frequency: 1
time_patterns:
  - business_hours
  - night_hours
business_hours_multiplier: 2.0
night_hours_multiplier: 5.0
weekend_multiplier: 4.0

documentation:
  display:
    title: "Azure AD Role Assignment"
    subtitle: "Add Member to Role - Privilege Escalation"
    icon: "ðŸ‘‘"
    color_scheme: "error"
    tags:
      - "azuread"
      - "role-assignment"
      - "privilege-escalation"
      - "identity"
      - "critical-security"
  
  overview:
    summary: "Captures Azure Active Directory role assignment operations where users are added to administrative roles. Global Administrator assignments are the highest risk as they grant complete control over the tenant. This event is critical for detecting privilege escalation attacks and unauthorized administrative access."
    when_generated:
      - "Administrator assigns user to Azure AD administrative role"
      - "New administrator account provisioned with elevated privileges"
      - "Attacker escalates privileges via compromised admin account"
      - "Emergency administrative access granted"
      - "Privileged Identity Management (PIM) activation"
    security_relevance: "Critical"
    compliance_frameworks:
      - "NIST 800-53 (AC-2, AC-6, IA-4)"
      - "PCI-DSS (Requirement 7 - Least Privilege)"
      - "SOX (Access Controls)"
      - "ISO 27001 (A.9.2 - User Access Management)"
      - "CIS Controls (5.4 - Restrict Administrator Privileges)"
    frequency_notes: "Very low frequency under normal operations (1 event/hour baseline). Role assignments should be rare, planned, and approved. Off-hours activity is extremely suspicious (5x night multiplier, 4x weekend). Global Administrator assignments require immediate investigation. Rapid successive assignments or assignments to newly created accounts are high-priority alerts."
  
  fields:
    - name: "CreationTime"
      type: "DateTime"
      required: true
      description: "Timestamp when the role assignment occurred"
      example_value: "2024-12-15T16:08:52Z"
      format: "ISO 8601"
      template_source: "now() | iso8601"
    
    - name: "Id"
      type: "String"
      required: true
      description: "Unique identifier for this audit record"
      example_value: "e7f8a9b0-c1d2-3e4f-5a6b-7c8d9e0f1a2b"
      format: "GUID"
      template_source: "random_guid()"
    
    - name: "Operation"
      type: "String"
      required: true
      description: "Azure AD operation performed"
      example_value: "Add member to role"
      template_source: "Static value 'Add member to role'"
    
    - name: "OrganizationId"
      type: "String"
      required: true
      description: "Microsoft 365 tenant identifier"
      example_value: "b4c5d6e7-8f9a-0b1c-2d3e-4f5a6b7c8d9e"
      format: "GUID"
      template_source: "Derived from organization domain"
    
    - name: "RecordType"
      type: "Integer"
      required: true
      description: "Office 365 audit log record type (8 = AzureActiveDirectory)"
      example_value: "8"
      template_source: "Static value 8"
      possible_values:
        - value: "8"
          description: "AzureActiveDirectory - Azure AD events including role assignments"
    
    - name: "ResultStatus"
      type: "String"
      required: true
      description: "Outcome of the role assignment operation"
      example_value: "Success"
      template_source: "random_choice(['Success', 'Success', 'Success', 'Failed'])"
      possible_values:
        - value: "Success"
          description: "Role assignment completed successfully"
        - value: "Failed"
          description: "Role assignment failed (insufficient permissions or validation error)"
    
    - name: "UserKey"
      type: "String"
      required: true
      description: "Unique identifier for the user who performed the role assignment"
      example_value: "admin@contoso.com"
      template_source: "registry.get_random_user().email"
    
    - name: "UserType"
      type: "Integer"
      required: true
      description: "Type of user performing the action"
      example_value: "2"
      template_source: "random_choice([0, 2])"
      possible_values:
        - value: "0"
          description: "Regular user (unusual for role assignments)"
        - value: "2"
          description: "Administrator (expected)"
    
    - name: "Workload"
      type: "String"
      required: true
      description: "Office 365 service where the operation occurred"
      example_value: "AzureActiveDirectory"
      template_source: "Static value 'AzureActiveDirectory'"
    
    - name: "UserId"
      type: "String"
      required: true
      description: "User principal name of the administrator account"
      example_value: "admin@contoso.com"
      format: "Email/UPN"
      template_source: "registry.get_random_user().email"
    
    - name: "ClientIP"
      type: "String"
      required: true
      description: "IP address from which the operation was performed"
      example_value: "203.0.113.92"
      format: "IPv4"
      template_source: "random_choice([random_public_ip(), random_private_ip()])"
    
    - name: "ObjectId"
      type: "String"
      required: true
      description: "Object identifier for the role assignment (User_GUID format)"
      example_value: "User_a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6d"
      template_source: "User_ prefix with random_guid()"
    
    - name: "Actor"
      type: "Array"
      required: true
      description: "Array containing actor information (user performing the assignment)"
      template_source: "Array with user ID and hex identifier"
    
    - name: "Actor[].ID"
      type: "String"
      required: true
      description: "Actor identifier (email or hex ID)"
      example_value: "admin@contoso.com"
      template_source: "User email or hex identifier"
    
    - name: "Actor[].Type"
      type: "Integer"
      required: true
      description: "Actor type identifier"
      example_value: "0"
      possible_values:
        - value: "0"
          description: "User principal"
        - value: "5"
          description: "Other identifier type"
    
    - name: "ActorContextId"
      type: "String"
      required: true
      description: "Tenant context of the actor"
      example_value: "b4c5d6e7-8f9a-0b1c-2d3e-4f5a6b7c8d9e"
      format: "GUID"
      template_source: "Derived from organization domain"
    
    - name: "ActorIpAddress"
      type: "String"
      required: true
      description: "IP address of the actor"
      example_value: "203.0.113.92"
      format: "IPv4"
      template_source: "random_choice([random_public_ip(), random_private_ip()])"
    
    - name: "Target"
      type: "Array"
      required: true
      description: "Array containing target user information (user receiving the role)"
      template_source: "Array with target user identifiers"
    
    - name: "Target[].ID"
      type: "String"
      required: true
      description: "Target user identifier"
      example_value: "newadmin@contoso.com"
      template_source: "User email or User_GUID format"
    
    - name: "Target[].Type"
      type: "Integer"
      required: true
      description: "Target type identifier"
      example_value: "2"
      possible_values:
        - value: "2"
          description: "User object"
        - value: "5"
          description: "Other identifier type"
    
    - name: "ApplicationId"
      type: "String"
      required: true
      description: "Application that facilitated the role assignment"
      example_value: "c44b4083-3bb0-49c1-b47d-974e53cbdf3c"
      format: "GUID"
      template_source: "Known Azure AD application GUIDs"
      possible_values:
        - value: "c44b4083-3bb0-49c1-b47d-974e53cbdf3c"
          description: "Azure AD PowerShell"
        - value: "00000002-0000-0000-c000-000000000000"
          description: "Azure AD Graph API"
        - value: "00000003-0000-0000-c000-000000000000"
          description: "Microsoft Graph"
    
    - name: "DeviceProperties"
      type: "Array"
      required: true
      description: "Properties of the device used for the role assignment"
      template_source: "Array with browser, compliance, and management status"
    
    - name: "DeviceProperties[].Name"
      type: "String"
      required: true
      description: "Property name (BrowserType, IsCompliant, IsManaged)"
      example_value: "IsCompliant"
    
    - name: "DeviceProperties[].Value"
      type: "String"
      required: true
      description: "Property value"
      example_value: "True"
      template_source: "Context-specific values for device properties"
    
    - name: "ExtendedProperties"
      type: "Array"
      required: true
      description: "Additional properties including user type and user agent"
      template_source: "Array with additional context"
    
    - name: "ModifiedProperties"
      type: "Array"
      required: true
      description: "Role details including role name and template ID"
      template_source: "Array showing role assignment details"
    
    - name: "ModifiedProperties[].Name"
      type: "String"
      required: true
      description: "Property name (Role.WellKnownObjectName, Role.DisplayName, Role.TemplateId, Role.ObjectID)"
      example_value: "Role.DisplayName"
    
    - name: "ModifiedProperties[].NewValue"
      type: "String"
      required: true
      description: "Role being assigned"
      example_value: "Global Administrator"
      template_source: "Azure AD role name or GUID"
      possible_values:
        - value: "Global Administrator"
          description: "Highest privilege - complete tenant control (TemplateId: 62e90394-69f5-4237-9190-012177145e10)"
        - value: "User Administrator"
          description: "Manage users and groups (TemplateId: fe930be7-5e62-47db-91af-98c3a49a38b1)"
        - value: "Privileged Role Administrator"
          description: "Manage role assignments (TemplateId: e8611ab8-c189-46e8-94e1-60213ab1f814)"
        - value: "Security Administrator"
          description: "Manage security settings (TemplateId: 194ae4cb-b126-40b2-bd5b-6091b380977d)"
        - value: "Helpdesk Administrator"
          description: "Reset passwords for non-admins (TemplateId: 729827e3-9c14-49f7-bb1b-9608f156bbb8)"
    
    - name: "ModifiedProperties[].OldValue"
      type: "String"
      required: true
      description: "Previous value (empty for new role assignments)"
      example_value: ""
      template_source: "Empty string"
    
    - name: "ExternalAccess"
      type: "Boolean"
      required: true
      description: "Indicates if the operation was performed from outside the corporate network"
      example_value: "true"
      template_source: "random_choice(['true', 'false', 'false']) - weighted toward internal"
    
    - name: "AzureActiveDirectoryEventType"
      type: "Integer"
      required: true
      description: "Type of Azure AD event"
      example_value: "1"
      template_source: "Static value 1"
    
    - name: "UserAgent"
      type: "String"
      required: true
      description: "Browser user agent string"
      example_value: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      template_source: "Random user agent string"
  
  resources:
    documentation:
      - title: "Office 365 Management Activity API Schema"
        url: "https://learn.microsoft.com/en-us/office/office-365-management-api/office-365-management-activity-api-schema"
        type: "official"
      - title: "Azure AD Built-in Roles"
        url: "https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference"
        type: "official"
      - title: "Privileged Identity Management (PIM)"
        url: "https://learn.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-configure"
        type: "official"
      - title: "MITRE ATT&CK - Account Manipulation (T1098)"
        url: "https://attack.mitre.org/techniques/T1098/"
        type: "reference"
    
    tools:
      - name: "Microsoft 365 Defender"
        description: "Native detection for suspicious role assignments and privilege escalation"
        url: "https://security.microsoft.com"
      - name: "Azure AD PowerShell"
        url: "https://learn.microsoft.com/en-us/powershell/module/azuread/"
        description: "Query and manage Azure AD roles and assignments"
      - name: "Azure Sentinel"
        url: "https://portal.azure.com/#blade/Microsoft_Azure_Security_Insights"
        description: "SIEM with built-in analytics for Azure AD privilege escalation"
