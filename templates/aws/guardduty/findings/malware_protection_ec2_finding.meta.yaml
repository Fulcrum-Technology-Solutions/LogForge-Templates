vendor: aws
product: guardduty
data_source: findings
description: AWS GuardDuty Malware Protection for EC2 finding types detecting malicious and suspicious files on EC2 instances, ECS clusters, Kubernetes clusters, and containers through EBS volume scanning, including trojans, backdoors, viruses, adware, spyware, ransomware, rootkits, miners, and worms
format: JSON
frequency: medium
is_generator: true
base_frequency: 15
time_patterns:
  - business_hours
  - night_hours
  - weekend
business_hours_multiplier: 1.5
night_hours_multiplier: 1.2
weekend_multiplier: 1.0

documentation:
  display:
    title: "GuardDuty Malware Protection for EC2 Finding Types"
    subtitle: "Malware detection on EC2 instances and containers"
    icon: "üõ°Ô∏è"
    color_scheme: "error"
    tags:
      - "malware-protection"
      - "ec2"
      - "container"
      - "malware-detection"
      - "threat-scanning"
  
  overview:
    summary: "Malware Protection for EC2 provides single findings for all threats detected during EBS volume scans of EC2 instances and container workloads. Includes total number of detections and details for top 32 threats based on severity. Findings include scan information and correlation with GuardDuty findings that initiated the scan."
    when_generated:
      - "Malicious file detected on EC2 instance during EBS volume scan"
      - "Malicious file detected on container workload in ECS cluster"
      - "Malicious file detected on container workload in Kubernetes cluster"
      - "Malicious file detected on standalone container workload"
      - "Suspicious file (adware, spyware, dual-use tool) detected on EC2 instance"
      - "Suspicious file (adware, spyware, dual-use tool) detected on container workload"
      - "Scan triggered by GuardDuty threat detection finding"
      - "Scheduled malware scan detects threats"
    security_relevance: "High"
    compliance_frameworks:
      - "PCI-DSS 5.1.1, 11.4"
      - "HIPAA 164.308(a)(1), 164.312(e)(1)"
      - "SOC 2 CC6.1, CC7.2"
      - "ISO 27001 A.12.4.1, A.12.4.2"
      - "NIST CSF PR.DS-5, DE.AE-3"
      - "CIS AWS Foundations 3.1-3.14"
    frequency_notes: "Malware Protection for EC2 findings are generated when malware scans detect threats. Frequency depends on threat landscape and scan frequency (triggered by GuardDuty findings or scheduled). Production environments typically see 5-30 findings per day. Each finding represents one scan with detected threats - findings are not updated when same resource is scanned again. New finding generated for each scan that detects malware. Malicious file findings are higher severity than suspicious file findings."
  
  fields:
    - name: "detail.type"
      type: "String"
      required: true
      description: "Malware Protection for EC2 finding type indicating resource and threat classification"
      example_value: "Execution:EC2/MaliciousFile"
      template_source: "random_choice() of 8 Malware Protection for EC2 finding types"
      possible_values:
        - value: "Execution:EC2/MaliciousFile"
          description: "Malicious file detected on EC2 instance"
        - value: "Execution:ECS/MaliciousFile"
          description: "Malicious file detected on container in ECS cluster"
        - value: "Execution:Kubernetes/MaliciousFile"
          description: "Malicious file detected on container in Kubernetes cluster"
        - value: "Execution:Container/MaliciousFile"
          description: "Malicious file detected on standalone container"
        - value: "Execution:EC2/SuspiciousFile"
          description: "Suspicious file (adware, spyware, dual-use tool) detected on EC2 instance"
        - value: "Execution:ECS/SuspiciousFile"
          description: "Suspicious file (adware, spyware, dual-use tool) detected on container in ECS cluster"
        - value: "Execution:Kubernetes/SuspiciousFile"
          description: "Suspicious file (adware, spyware, dual-use tool) detected on container in Kubernetes cluster"
        - value: "Execution:Container/SuspiciousFile"
          description: "Suspicious file (adware, spyware, dual-use tool) detected on standalone container"
    
    - name: "detail.resource.resourceType"
      type: "String"
      required: true
      description: "Type of resource where malware was detected"
      example_value: "Instance"
      template_source: "random_choice(['Instance', 'EKSCluster', 'ECSCluster', 'Container'])"
      possible_values:
        - value: "Instance"
          description: "Amazon EC2 instance"
        - value: "EKSCluster"
          description: "Amazon EKS cluster (for Kubernetes findings)"
        - value: "ECSCluster"
          description: "Amazon ECS cluster (for ECS findings)"
        - value: "Container"
          description: "Standalone container (for Container findings)"
    
    - name: "detail.service.malwareProtectionScanDetails"
      type: "Object"
      required: true
      description: "Details about the malware scan that detected the threats"
      example_value: "{scanId, scanStartTime, scanEndTime, scannedResourceDetails, triggerFindingId, sources}"
      template_source: "Malware scan metadata from GuardDuty"
    
    - name: "detail.service.malwareProtectionScanDetails.scanId"
      type: "String"
      required: true
      description: "Unique identifier for the malware scan"
      example_value: "550e8400-e29b-41d4-a716-446655440000"
      format: "UUID"
      template_source: "random_guid()"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.volumeDetails"
      type: "Array"
      required: true
      description: "EBS volume details that were scanned"
      example_value: "[{volumeArn, volumeType, deviceName, volumeSizeInGB, encryptionType}]"
      template_source: "EBS volume metadata from scan"
    
    - name: "detail.service.malwareProtectionScanDetails.triggerFindingId"
      type: "String"
      required: false
      description: "GuardDuty finding ID that triggered this scan (if scan was triggered by finding)"
      example_value: "a1b2c3d4e5f6..."
      format: "32-character hexadecimal string"
      template_source: "random_hex(32, 32) or empty if scheduled scan"
    
    - name: "detail.service.malwareProtectionScanDetails.sources"
      type: "Array"
      required: true
      description: "Source that initiated the scan"
      example_value: "['THREAT_DETECTION']"
      template_source: "random_choice(['THREAT_DETECTION', 'SCHEDULED_SCAN'])"
      possible_values:
        - value: "THREAT_DETECTION"
          description: "Scan triggered by GuardDuty threat detection finding"
        - value: "SCHEDULED_SCAN"
          description: "Scan performed on scheduled basis"
    
    - name: "detail.service.additionalInfo.threatsDetectedItemCount"
      type: "Integer"
      required: true
      description: "Total number of threats detected during the scan"
      example_value: "15"
      format: "Integer (1 or more)"
      template_source: "random_int(1, 32) - total detections in scan"
    
    - name: "detail.service.additionalInfo.threatsDetected"
      type: "Array"
      required: true
      description: "Details for top 32 threats detected (based on severity). Each finding includes up to 32 threats."
      example_value: "[{threatName, severity, itemCount, files}]"
      template_source: "Array of threat details from malware scan"
    
    - name: "detail.service.additionalInfo.threatsDetected[].threatName"
      type: "String"
      required: true
      description: "Name of the detected threat"
      example_value: "Trojan.Win32.Generic"
      format: "Threat name"
      template_source: "random_choice() of malware threat names"
      possible_values:
        - value: "Trojan.Win32.Generic"
          description: "Windows trojan"
        - value: "Trojan.Linux.Generic"
          description: "Linux trojan"
        - value: "Backdoor.Linux.Generic"
          description: "Linux backdoor"
        - value: "Virus.Win32.Generic"
          description: "Windows virus"
        - value: "Adware.Mac.Generic"
          description: "Mac adware"
        - value: "Spyware.Win32.Generic"
          description: "Windows spyware"
        - value: "Ransomware.Win32.Generic"
          description: "Windows ransomware"
        - value: "PUA.Win32.Generic"
          description: "Potentially Unwanted Application"
        - value: "Rootkit.Linux.Generic"
          description: "Linux rootkit"
        - value: "Miner.Linux.Generic"
          description: "Cryptocurrency miner"
    
    - name: "detail.service.additionalInfo.threatsDetected[].files[].filePath"
      type: "String"
      required: true
      description: "Full path to the malicious or suspicious file. Note: File paths may be controlled by malicious actors and should be sanitized when displayed"
      example_value: "/tmp/malware.exe"
      format: "Absolute file path"
      template_source: "File path from malware scan"
    
    - name: "detail.service.additionalInfo.threatsDetected[].files[].fileHash"
      type: "String"
      required: true
      description: "SHA-256 hash of the malicious or suspicious file"
      example_value: "a1b2c3d4e5f6..."
      format: "64-character hexadecimal string"
      template_source: "SHA-256 hash of file content"
    
    - name: "detail.severity"
      type: "Integer"
      required: true
      description: "Finding severity level (varies depending on detected threat severity)"
      example_value: "8"
      template_source: "random_choice([2, 5, 5, 8, 8, 8]) - varies based on threat"
      possible_values:
        - value: "2"
          description: "Low severity (1.0-3.9) - typically suspicious files"
        - value: "5"
          description: "Medium severity (4.0-6.9)"
        - value: "8"
          description: "High severity (7.0-8.9) - typically malicious files"
  
  resources:
    documentation:
      - title: "Malware Protection for EC2 Finding Types"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/findings-malware-protection.html"
        type: "official"
      - title: "Remediating Potentially Compromised EC2 Instance"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/compromised-ec2.html"
        type: "official"
      - title: "Remediating Potentially Compromised ECS Cluster"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/compromised-ecs.html"
        type: "official"
      - title: "Remediating EKS Protection Findings"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_eks.html"
        type: "official"
      - title: "GuardDuty Malware Protection for EC2"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_malware-protection.html"
        type: "official"
    tools:
      - name: "AWS GuardDuty Console"
        description: "Web interface for viewing and managing Malware Protection findings"
        url: "https://console.aws.amazon.com/guardduty/"
      - name: "AWS Systems Manager"
        description: "Manage GuardDuty malware protection agents"
        url: "https://aws.amazon.com/systems-manager/"

