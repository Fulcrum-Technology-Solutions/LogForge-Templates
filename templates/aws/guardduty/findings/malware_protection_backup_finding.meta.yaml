vendor: aws
product: guardduty
data_source: findings
description: AWS GuardDuty Malware Protection for Backup finding types detecting malicious files in EBS snapshots, EC2 AMIs, AWS Backup EC2 Recovery Points, and AWS Backup S3 Recovery Points through backup scanning, including trojans, backdoors, viruses, ransomware, spyware, rootkits, miners, worms, and potentially unwanted applications
format: JSON
frequency: low
is_generator: true
base_frequency: 3
time_patterns:
  - business_hours
  - night_hours
  - weekend
business_hours_multiplier: 1.2
night_hours_multiplier: 1.0
weekend_multiplier: 0.8

documentation:
  display:
    title: "GuardDuty Malware Protection for Backup Finding Types"
    subtitle: "Malware detection in backups, snapshots, and recovery points"
    icon: "ðŸ’¾"
    color_scheme: "error"
    tags:
      - "malware-protection"
      - "backup"
      - "snapshot"
      - "ami"
      - "recovery-point"
      - "malware-detection"
  
  overview:
    summary: "Malware Protection for Backup provides single findings for all threats detected during scans of EBS snapshots, EC2 AMIs, AWS Backup EC2 Recovery Points, and AWS Backup S3 Recovery Points. Includes total number of detections and details for top 32 threats based on severity. Findings are not updated when same resource is scanned again - new finding generated for each scan that detects malware."
    when_generated:
      - "Malicious file detected in EBS snapshot during backup scan"
      - "Malicious file detected in EC2 AMI during backup scan"
      - "Malicious file detected in AWS Backup EC2 Recovery Point (snapshot or AMI)"
      - "Malicious file detected in AWS Backup S3 Recovery Point"
      - "Scan triggered by GuardDuty threat detection finding"
      - "Scheduled backup malware scan detects threats"
      - "On-demand backup scan detects threats"
    security_relevance: "High"
    compliance_frameworks:
      - "PCI-DSS 5.1.1, 11.4"
      - "HIPAA 164.308(a)(1), 164.312(e)(1)"
      - "SOC 2 CC6.1, CC7.2"
      - "ISO 27001 A.12.4.1, A.12.4.2"
      - "NIST CSF PR.DS-5, DE.AE-3"
      - "CIS AWS Foundations 3.1-3.14"
    frequency_notes: "Malware Protection for Backup findings are generated when backup scans detect threats. Frequency depends on backup volume, scan frequency, and threat landscape. Production environments typically see 1-10 findings per week. Each finding represents one backup scan with detected threats - findings are not updated when same resource is scanned again. New finding generated for each scan that detects malware. Severity varies depending on detected threat."
  
  fields:
    - name: "detail.type"
      type: "String"
      required: true
      description: "Malware Protection for Backup finding type indicating resource type and threat classification"
      example_value: "Execution:EC2/MaliciousFile!Snapshot"
      template_source: "random_choice() of 4 Malware Protection for Backup finding types"
      possible_values:
        - value: "Execution:EC2/MaliciousFile!Snapshot"
          description: "Malicious file detected in EBS snapshot"
        - value: "Execution:EC2/MaliciousFile!AMI"
          description: "Malicious file detected in EC2 AMI"
        - value: "Execution:EC2/MaliciousFile!RecoveryPoint"
          description: "Malicious file detected in AWS Backup EC2 Recovery Point (snapshot or AMI)"
        - value: "Execution:S3/MaliciousFile!RecoveryPoint"
          description: "Malicious file detected in AWS Backup S3 Recovery Point"
    
    - name: "detail.resource.resourceType"
      type: "String"
      required: true
      description: "Type of resource where malware was detected"
      example_value: "Snapshot"
      template_source: "random_choice(['Instance', 'Snapshot', 'AMI', 'RecoveryPoint', 'S3Bucket'])"
      possible_values:
        - value: "Instance"
          description: "Amazon EC2 instance (source of snapshot/AMI)"
        - value: "Snapshot"
          description: "EBS snapshot (for !Snapshot findings)"
        - value: "AMI"
          description: "EC2 AMI (for !AMI findings)"
        - value: "RecoveryPoint"
          description: "AWS Backup recovery point (for !RecoveryPoint findings)"
        - value: "S3Bucket"
          description: "S3 bucket (for S3 Recovery Point findings)"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.snapshotArn"
      type: "String"
      required: false
      description: "ARN of the EBS snapshot that was scanned (for !Snapshot findings)"
      example_value: "arn:aws:ec2:us-east-1:snapshot/snap-1234567890abcdef0"
      format: "EBS snapshot ARN"
      template_source: "EBS snapshot ARN from scan details"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.amiArn"
      type: "String"
      required: false
      description: "ARN of the EC2 AMI that was scanned (for !AMI findings)"
      example_value: "arn:aws:ec2:us-east-1::image/ami-12345678"
      format: "EC2 AMI ARN"
      template_source: "EC2 AMI ARN from scan details"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.recoveryPointArn"
      type: "String"
      required: false
      description: "ARN of the AWS Backup recovery point that was scanned (for !RecoveryPoint findings)"
      example_value: "arn:aws:backup:us-east-1:123456789012:recovery-point:EC2:abc123..."
      format: "AWS Backup recovery point ARN"
      template_source: "AWS Backup recovery point ARN from scan details"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.volumeDetails"
      type: "Array"
      required: false
      description: "EBS volume details from snapshot/AMI that were scanned"
      example_value: "[{volumeArn, volumeType, deviceName, volumeSizeInGB, encryptionType}]"
      template_source: "EBS volume metadata from backup scan"
    
    - name: "detail.service.malwareProtectionScanDetails.scanId"
      type: "String"
      required: true
      description: "Unique identifier for the backup malware scan"
      example_value: "550e8400-e29b-41d4-a716-446655440000"
      format: "UUID"
      template_source: "random_guid()"
    
    - name: "detail.service.malwareProtectionScanDetails.triggerFindingId"
      type: "String"
      required: false
      description: "GuardDuty finding ID that triggered this scan (if scan was triggered by finding)"
      example_value: "a1b2c3d4e5f6..."
      format: "32-character hexadecimal string"
      template_source: "random_hex(32, 32) or empty if scheduled/on-demand scan"
    
    - name: "detail.service.malwareProtectionScanDetails.sources"
      type: "Array"
      required: true
      description: "Source that initiated the backup scan"
      example_value: "['THREAT_DETECTION']"
      template_source: "random_choice(['THREAT_DETECTION', 'SCHEDULED_SCAN', 'ON_DEMAND'])"
      possible_values:
        - value: "THREAT_DETECTION"
          description: "Scan triggered by GuardDuty threat detection finding"
        - value: "SCHEDULED_SCAN"
          description: "Scan performed on scheduled basis"
        - value: "ON_DEMAND"
          description: "Scan triggered on-demand"
    
    - name: "detail.service.additionalInfo.threatsDetectedItemCount"
      type: "Integer"
      required: true
      description: "Total number of threats detected during the backup scan"
      example_value: "5"
      format: "Integer (1 or more)"
      template_source: "random_int(1, 32) - total detections in scan"
    
    - name: "detail.service.additionalInfo.threatsDetected"
      type: "Array"
      required: true
      description: "Details for top 32 threats detected (based on severity). Each finding includes up to 32 threats."
      example_value: "[{threatName, severity, itemCount, files}]"
      template_source: "Array of threat details from backup malware scan"
    
    - name: "detail.service.additionalInfo.threatsDetected[].threatName"
      type: "String"
      required: true
      description: "Name of the detected threat"
      example_value: "Trojan.Win32.Generic"
      format: "Threat name"
      template_source: "random_choice() of malware threat names"
      possible_values:
        - value: "Trojan.Win32.Generic"
          description: "Windows trojan"
        - value: "Trojan.Linux.Generic"
          description: "Linux trojan"
        - value: "Backdoor.Linux.Generic"
          description: "Linux backdoor"
        - value: "Virus.Win32.Generic"
          description: "Windows virus"
        - value: "Ransomware.Win32.Generic"
          description: "Windows ransomware"
        - value: "Spyware.Win32.Generic"
          description: "Windows spyware"
        - value: "Rootkit.Linux.Generic"
          description: "Linux rootkit"
        - value: "Miner.Linux.Generic"
          description: "Cryptocurrency miner"
        - value: "Worm.Win32.Generic"
          description: "Windows worm"
        - value: "PUA.Win32.Generic"
          description: "Potentially Unwanted Application"
    
    - name: "detail.service.additionalInfo.threatsDetected[].files[].filePath"
      type: "String"
      required: true
      description: "Full path to the malicious file in the backup/snapshot/AMI. Note: File paths may be controlled by malicious actors and should be sanitized when displayed"
      example_value: "/tmp/malware.exe"
      format: "Absolute file path"
      template_source: "File path from backup malware scan"
    
    - name: "detail.service.additionalInfo.threatsDetected[].files[].fileHash"
      type: "String"
      required: true
      description: "SHA-256 hash of the malicious file"
      example_value: "a1b2c3d4e5f6..."
      format: "64-character hexadecimal string"
      template_source: "SHA-256 hash of file content"
    
    - name: "detail.severity"
      type: "Integer"
      required: true
      description: "Finding severity level (varies depending on detected threat severity)"
      example_value: "8"
      template_source: "random_choice([2, 5, 5, 8, 8, 8]) - varies based on threat"
      possible_values:
        - value: "2"
          description: "Low severity (1.0-3.9)"
        - value: "5"
          description: "Medium severity (4.0-6.9)"
        - value: "8"
          description: "High severity (7.0-8.9)"
  
  resources:
    documentation:
      - title: "Malware Protection for Backup Finding Types"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/findings-malware-protection-backup.html"
        type: "official"
      - title: "Remediating Potentially Compromised EBS Snapshot"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/compromised-snapshot.html"
        type: "official"
      - title: "Remediating Potentially Compromised EC2 AMI"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/compromised-ami.html"
        type: "official"
      - title: "Remediating Potentially Compromised EC2 Recovery Point"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/compromised-recovery-point-ec2.html"
        type: "official"
      - title: "Remediating Potentially Compromised S3 Recovery Point"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/compromised-recovery-point-s3.html"
        type: "official"
      - title: "GuardDuty Malware Protection for Backup"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_malware-protection-backup.html"
        type: "official"
    tools:
      - name: "AWS GuardDuty Console"
        description: "Web interface for viewing and managing Backup malware protection findings"
        url: "https://console.aws.amazon.com/guardduty/"
      - name: "AWS Backup"
        description: "Manage AWS Backup recovery points and vaults"
        url: "https://aws.amazon.com/backup/"

