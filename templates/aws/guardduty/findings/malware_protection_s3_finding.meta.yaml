vendor: aws
product: guardduty
data_source: findings
description: AWS GuardDuty Malware Protection for S3 finding type detecting malicious files in S3 objects during upload-triggered scans, including trojans, backdoors, viruses, ransomware, spyware, rootkits, miners, worms, and adware
format: JSON
frequency: low
is_generator: true
base_frequency: 5
time_patterns:
  - business_hours
  - night_hours
  - weekend
business_hours_multiplier: 2.0
night_hours_multiplier: 1.5
weekend_multiplier: 1.0

documentation:
  display:
    title: "GuardDuty Malware Protection for S3 Finding Type"
    subtitle: "Malware detection on S3 objects"
    icon: "ðŸª£"
    color_scheme: "error"
    tags:
      - "malware-protection"
      - "s3"
      - "malware-detection"
      - "object-scanning"
  
  overview:
    summary: "Malware Protection for S3 generates findings when malware scans detect malicious files in uploaded S3 objects. Requires both GuardDuty and Malware Protection for S3 to be enabled. Scans are triggered when objects are uploaded to protected buckets. Includes total number of detections and details for top 32 threats based on severity."
    when_generated:
      - "Malicious file detected in S3 object during upload-triggered scan"
      - "Object uploaded to protected S3 bucket contains malware"
      - "Malware scan detects threat in scanned S3 object"
      - "Scan triggered by S3 object upload event"
    security_relevance: "High"
    compliance_frameworks:
      - "PCI-DSS 5.1.1, 11.4"
      - "HIPAA 164.308(a)(1), 164.312(e)(1)"
      - "SOC 2 CC6.1, CC7.2"
      - "ISO 27001 A.12.4.1, A.12.4.2"
      - "NIST CSF PR.DS-5, DE.AE-3"
      - "CIS AWS Foundations 3.1-3.14"
    frequency_notes: "Malware Protection for S3 findings are generated when uploaded objects contain malware. Frequency depends on upload volume and threat landscape. Production environments typically see 1-10 findings per day. Each finding represents one object scan with detected threats. Objects scanned before enabling GuardDuty won't generate findings - must re-upload object to scan. Default severity is High (8.0)."
  
  fields:
    - name: "detail.type"
      type: "String"
      required: true
      description: "Malware Protection for S3 finding type (always Object:S3/MaliciousFile)"
      example_value: "Object:S3/MaliciousFile"
      template_source: "Fixed value for S3 malware protection findings"
      possible_values:
        - value: "Object:S3/MaliciousFile"
          description: "Malicious file detected in scanned S3 object"
    
    - name: "detail.resource.s3BucketDetails"
      type: "Array"
      required: true
      description: "Details about S3 bucket containing the malicious object"
      example_value: "[{name, arn, type, owner, tags, publicAccess}]"
      template_source: "S3 bucket metadata from GuardDuty"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.bucketArn"
      type: "String"
      required: true
      description: "ARN of the S3 bucket containing the scanned object"
      example_value: "arn:aws:s3:::data-bucket-123456"
      format: "S3 bucket ARN"
      template_source: "S3 bucket ARN from scan details"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.objectKey"
      type: "String"
      required: true
      description: "S3 object key (path) of the scanned object containing malware. Note: Object keys may be controlled by malicious actors and should be sanitized when displayed"
      example_value: "uploads/malware.exe"
      format: "S3 object key (path)"
      template_source: "S3 object key from scan details"
    
    - name: "detail.service.malwareProtectionScanDetails.scannedResourceDetails.objectVersionId"
      type: "String"
      required: false
      description: "Version ID of the S3 object (if versioning is enabled)"
      example_value: "null"
      format: "S3 object version ID or 'null'"
      template_source: "S3 object version ID or null"
    
    - name: "detail.service.malwareProtectionScanDetails.scanId"
      type: "String"
      required: true
      description: "Unique identifier for the malware scan"
      example_value: "550e8400-e29b-41d4-a716-446655440000"
      format: "UUID"
      template_source: "random_guid()"
    
    - name: "detail.service.malwareProtectionScanDetails.triggerFindingId"
      type: "String"
      required: false
      description: "GuardDuty finding ID that triggered this scan (if scan was triggered by finding)"
      example_value: "a1b2c3d4e5f6..."
      format: "32-character hexadecimal string"
      template_source: "random_hex(32, 32) or empty if upload-triggered"
    
    - name: "detail.service.malwareProtectionScanDetails.sources"
      type: "Array"
      required: true
      description: "Source that initiated the scan"
      example_value: "['THREAT_DETECTION']"
      template_source: "random_choice(['THREAT_DETECTION', 'SCHEDULED_SCAN', 'ON_DEMAND'])"
      possible_values:
        - value: "THREAT_DETECTION"
          description: "Scan triggered by GuardDuty threat detection finding"
        - value: "SCHEDULED_SCAN"
          description: "Scan performed on scheduled basis"
        - value: "ON_DEMAND"
          description: "Scan triggered by object upload to protected bucket"
    
    - name: "detail.service.additionalInfo.threatsDetectedItemCount"
      type: "Integer"
      required: true
      description: "Total number of threats detected during the scan"
      example_value: "3"
      format: "Integer (1 or more)"
      template_source: "random_int(1, 32) - total detections in scan"
    
    - name: "detail.service.additionalInfo.threatsDetected"
      type: "Array"
      required: true
      description: "Details for top 32 threats detected (based on severity). Each finding includes up to 32 threats."
      example_value: "[{threatName, severity, itemCount, files}]"
      template_source: "Array of threat details from malware scan"
    
    - name: "detail.service.additionalInfo.threatsDetected[].threatName"
      type: "String"
      required: true
      description: "Name of the detected threat"
      example_value: "Trojan.Win32.Generic"
      format: "Threat name"
      template_source: "random_choice() of malware threat names"
      possible_values:
        - value: "Trojan.Win32.Generic"
          description: "Windows trojan"
        - value: "Trojan.Linux.Generic"
          description: "Linux trojan"
        - value: "Backdoor.Linux.Generic"
          description: "Linux backdoor"
        - value: "Virus.Win32.Generic"
          description: "Windows virus"
        - value: "Ransomware.Win32.Generic"
          description: "Windows ransomware"
        - value: "Spyware.Win32.Generic"
          description: "Windows spyware"
        - value: "Rootkit.Linux.Generic"
          description: "Linux rootkit"
        - value: "Miner.Linux.Generic"
          description: "Cryptocurrency miner"
        - value: "Worm.Win32.Generic"
          description: "Windows worm"
        - value: "Adware.Mac.Generic"
          description: "Mac adware"
    
    - name: "detail.service.additionalInfo.threatsDetected[].files[].filePath"
      type: "String"
      required: true
      description: "S3 object key or path within object to the malicious file. Note: File paths may be controlled by malicious actors and should be sanitized when displayed"
      example_value: "uploads/malware.exe"
      format: "S3 object key or internal file path"
      template_source: "File path from malware scan"
    
    - name: "detail.service.additionalInfo.threatsDetected[].files[].fileHash"
      type: "String"
      required: true
      description: "SHA-256 hash of the malicious file"
      example_value: "a1b2c3d4e5f6..."
      format: "64-character hexadecimal string"
      template_source: "SHA-256 hash of file content"
    
    - name: "detail.severity"
      type: "Integer"
      required: true
      description: "Finding severity level (default is High/8.0 for S3 malware findings)"
      example_value: "8"
      template_source: "random_choice([5, 8, 8, 8]) - default is High"
      possible_values:
        - value: "5"
          description: "Medium severity (4.0-6.9)"
        - value: "8"
          description: "High severity (7.0-8.9) - default for S3 malware findings"
  
  resources:
    documentation:
      - title: "Malware Protection for S3 Finding Type"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/gdu-malware-protection-s3-finding-types.html"
        type: "official"
      - title: "Remediating Potentially Malicious S3 Object"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/compromised-s3.html"
        type: "official"
      - title: "GuardDuty Malware Protection for S3"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_malware-protection-s3.html"
        type: "official"
      - title: "Enabling Malware Protection for S3"
        url: "https://docs.aws.amazon.com/guardduty/latest/ug/malware-protection-s3-enable.html"
        type: "official"
    tools:
      - name: "AWS GuardDuty Console"
        description: "Web interface for viewing and managing S3 malware protection findings"
        url: "https://console.aws.amazon.com/guardduty/"
      - name: "AWS S3 Console"
        description: "Manage S3 buckets and objects"
        url: "https://console.aws.amazon.com/s3/"

