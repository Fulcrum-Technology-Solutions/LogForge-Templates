{%- set user = registry.get_random_user() -%}
{%- set device = registry.get_random_device() -%}
{%- set file_server = registry.get_random_device() -%}
{%- set severity_choices = ['1', '3', '5', '7'] -%}
{%- set severity_weights = [5, 60, 30, 5] -%}
{%- set severity = random_weighted(severity_choices, severity_weights) -%}
{%- set event_types = [
    'Abnormal file access',
    'Excessive file access',
    'Sensitive file access',
    'After-hours file access',
    'Unusual location access',
    'Mass file download'
] -%}
{%- set event_weights = [30, 25, 20, 15, 5, 5] -%}
{%- set event_type = random_weighted(event_types, event_weights) -%}
{%- set rule_names = [
    'Excessive File Access by User',
    'Sensitive Data Access Pattern',
    'After Hours File Access Alert',
    'Abnormal File Download Volume',
    'Unusual Geographic Access',
    'Executive Data Access Monitor'
] -%}
{%- set rule_name = random_choice(rule_names) -%}
{%- set file_extensions = ['.xlsx', '.docx', '.pdf', '.pptx', '.csv', '.txt', '.zip'] -%}
{%- set file_paths = [
    '\\\\FileServer\\Finance\\Reports',
    '\\\\FileServer\\HR\\Personnel',
    '\\\\FileServer\\Legal\\Contracts',
    '\\\\FileServer\\Engineering\\Projects',
    '\\\\FileServer\\Sales\\Accounts',
    '\\\\FileServer\\Executive\\Board'
] -%}
{%- set file_path = random_choice(file_paths) -%}
{%- set file_name = random_string(8) + random_choice(file_extensions) -%}
{%- set outcomes = ['Success', 'Blocked', 'Alerted'] -%}
{%- set outcome_weights = [70, 20, 10] -%}
{%- set outcome = random_weighted(outcomes, outcome_weights) -%}
{%- set alert_time = now() -%}
{%- set event_time = subtract_seconds(alert_time, random_int(60, 3600)) -%}
{%- set first_event_time = subtract_seconds(event_time, random_int(300, 7200)) -%}
{%- set alert_id = random_int(100000, 999999) -%}
{%- set rule_id = random_int(1000, 9999) -%}
{%- set threshold = random_int(5, 50) -%}
{%- set version = random_choice(['8.0', '8.5', '9.0', '9.5']) -%}
{%- set op_code = random_int(1000, 1999) -%}
CEF:0|Varonis|DatAdvantage|{{ version }}|{{ op_code }}|{{ event_type }}|{{ severity }}|rt={{ alert_time | format_datetime('%b %d %Y %H:%M:%S GMT') }} cat=Alert cs2={{ rule_name }} cs2Label=RuleName cn1={{ rule_id }} cn1Label=RuleID end={{ event_time | format_datetime('%b %d %Y %H:%M:%S GMT') }} duser={{ user.username }} dhost={{ file_server.hostname }} filePath={{ file_path }} fname={{ file_name }} act={{ event_type }} dvchost={{ device.hostname }} dvc={{ device.ip_address }} outcome={{ outcome }} msg=User {{ user.username }} triggered alert: {{ event_type }} on {{ file_server.hostname }} cs4=http://{{ random_private_ip() }}/DatAdvantage/#/app/analytics/entity/Alert/{{ alert_id }} cs4Label=AlertURL cnt={{ threshold }} start={{ first_event_time | format_datetime('%b %d %Y %H:%M:%S GMT') }} externalId={{ alert_id }}